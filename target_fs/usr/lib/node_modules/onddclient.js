(function (fs, dgram) {

class onddListener {

    constructor (socketPath) {
        this.socketPath = socketPath;
        this.dataStore = null;
        this.socket = null;
        this.statusCallback = null;
    }

    setStatusCallback (cb) {
        this.statusCallback  = cb;
    }

    getStatus() {
        return this.dataStore;
    }

    _onData(d) {
        var ds = d.toString();
        try {
            var j = JSON.parse(ds);
            this.dataStore = j;
            if (this.statusCallback)
                this.statusCallback(j);
            } catch(err) {
            }
    }

    start() {

        if (fs.existsSync(this.socketPath))  fs.unlinkSync(this.socketPath);

	this.socket = dgram.createSocket('unix_dgram', this._onData.bind(this));

        this.socket.bind(this.socketPath);
    }

}

module.exports.listener = onddListener;

})(require('fs'), require('unix-dgram'));
